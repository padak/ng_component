# {{ api_name }} Driver

ü§ñ **AUTO-GENERATED by Driver Creator Agent**
üìÖ **Generated:** {{ "now" }}

## Overview

{{ api_type }} driver for {{ api_name }} following [Driver Design v2.0](../docs/driver_design_v2.md) specification.

**Base URL:** `{{ base_url }}`

## Installation

```bash
pip install {{ driver_name }}
```

## Quick Start

```python
from {{ driver_name }} import {{ driver_class }}

# Option 1: Load from environment
client = {{ driver_class }}.from_env()

# Option 2: Explicit credentials
client = {{ driver_class }}(
    api_url="{{ base_url }}",
    api_key="your_api_key_here"
)

# Discovery
objects = client.list_objects()
print(f"Available objects: {', '.join(objects)}")

fields = client.get_fields("YourObject")
print(f"Fields: {list(fields.keys())}")

{% if query_language %}
# Query data
results = client.read("SELECT * FROM YourObject LIMIT 10")
{% else %}
# Read data
results = client.read(limit=10)
{% endif %}
print(f"Found {len(results)} records")

# Cleanup
client.close()
```

## Authentication

### Getting Credentials

1. Sign up for {{ api_name }} account
2. Navigate to API settings
3. Generate API key
4. Copy your API key and base URL

### Environment Variables

Create a `.env` file in your project root:

```bash
{{ driver_name.upper() }}_API_URL={{ base_url }}
{{ driver_name.upper() }}_API_KEY=your_api_key_here
```

Then use `from_env()` method:

```python
client = {{ driver_class }}.from_env()
```

{% if query_language %}
## Query Language

**Language:** {{ query_language }}

### Syntax

{{ query_language }} uses SQL-like syntax:

```
SELECT field1, field2, ...
FROM object_name
WHERE condition
{% if pagination_style == "offset" %}LIMIT n OFFSET m{% elif pagination_style == "cursor" %}LIMIT n{% endif %}
```

### Examples

**Basic query:**
```python
query = "SELECT id, name FROM Object"
results = client.read(query)
```

**With filters:**
```python
query = """
    SELECT id, name, created_at
    FROM Object
    WHERE created_at >= '2024-01-01'
"""
results = client.read(query)
```

**With limit:**
```python
query = "SELECT * FROM Object LIMIT 100"
results = client.read(query)
```

{% endif %}

## Capabilities

```python
capabilities = client.get_capabilities()

# Check what the driver supports:
print(f"Read operations: {capabilities.read}")
print(f"Write operations: {capabilities.write}")
print(f"Query language: {capabilities.query_language}")
print(f"Pagination style: {capabilities.pagination.value}")
```

**This driver supports:**

- ‚úÖ Read operations{% if query_language %} ({{ query_language }} queries){% endif %}
{% if supports_write %}- ‚úÖ Write operations (create, update){% else %}- ‚ùå Write operations (read-only){% endif %}
{% if supports_delete %}- ‚úÖ Delete operations{% else %}- ‚ùå Delete operations (not supported){% endif %}
- ‚ùå Batch operations (not yet implemented)
{% if pagination_style != "none" %}- ‚úÖ Pagination ({{ pagination_style }}-based){% else %}- ‚ùå Pagination (not needed){% endif %}

## Common Patterns

### Error Handling

```python
from {{ driver_name }}.exceptions import (
    ObjectNotFoundError,
    RateLimitError,
    QuerySyntaxError
)

try:
    results = client.read("SELECT * FROM NonExistentObject")
{% if query_language %}
except QuerySyntaxError as e:
    print(f"Query error: {e.message}")
    print(f"Details: {e.details}")
{% endif %}
except ObjectNotFoundError as e:
    print(f"Error: {e.message}")
    print(f"Available objects: {e.details['available']}")

except RateLimitError as e:
    print(f"Rate limited. Retry after {e.details['retry_after']} seconds")
```

### Discovery Pattern

Always discover schema before querying:

```python
# Step 1: Discover available objects
objects = client.list_objects()
print(f"Available: {', '.join(objects)}")

# Step 2: Get field schema
fields = client.get_fields("YourObject")
available_fields = list(fields.keys())

# Step 3: Build query dynamically
{% if query_language %}
query = f"SELECT {', '.join(available_fields[:5])} FROM YourObject LIMIT 10"
results = client.read(query)
{% else %}
results = client.read(limit=10)
{% endif %}
```

{% if api_type == "REST" %}
### Low-Level API Access

For advanced use cases, call endpoints directly:

```python
# Direct endpoint call
result = client.call_endpoint(
    endpoint="/items",
    method="GET",
    params={
        "limit": 100,
        "start_date": "2024-01-01"
    }
)
```
{% endif %}

### Debug Mode

Enable debug logging to see all API calls:

```python
client = {{ driver_class }}(
    api_url="{{ base_url }}",
    api_key="your_key",
    debug=True
)

# Now all API calls are logged:
# [DEBUG] GET {{ base_url }}/objects
# [DEBUG] Rate limited. Retrying in 2s...
```

## Rate Limits

{% if rate_limit %}
**Limit:** {{ rate_limit }}

The driver automatically handles rate limiting with exponential backoff:
- Retries up to `max_retries` times (default: 3)
- Uses `Retry-After` header from API responses
- Falls back to exponential backoff (2^attempt seconds)
{% else %}
**Rate limits:** Check {{ api_name }} API documentation.

The driver implements automatic retry with exponential backoff.
{% endif %}

Check remaining rate limit:

```python
status = client.get_rate_limit_status()
if status["remaining"]:
    print(f"API calls remaining: {status['remaining']}/{status['limit']}")
```

## API Reference

### Core Methods

#### `list_objects() -> List[str]`

Discover all available objects/tables.

```python
objects = client.list_objects()
# Returns: ["Object1", "Object2", ...]
```

#### `get_fields(object_name: str) -> Dict[str, Any]`

Get field schema for an object.

```python
fields = client.get_fields("YourObject")
# Returns: {
#     "field_name": {
#         "type": "string",
#         "label": "Field Name",
#         "required": False,
#         "nullable": True
#     },
#     ...
# }
```

{% if query_language %}
#### `read(query: str, limit: Optional[int] = None, offset: Optional[int] = None) -> List[Dict[str, Any]]`

Execute {{ query_language }} query.

```python
results = client.read("SELECT * FROM Object LIMIT 10")
# Returns: [{"field1": "value1", ...}, ...]
```
{% else %}
#### `read(limit: Optional[int] = None, offset: Optional[int] = None) -> List[Dict[str, Any]]`

Read data from default endpoint.

```python
results = client.read(limit=10)
# Returns: [{"field1": "value1", ...}, ...]
```
{% endif %}

#### `get_capabilities() -> DriverCapabilities`

Get driver capabilities.

```python
caps = client.get_capabilities()
print(f"Query language: {caps.query_language}")
print(f"Pagination: {caps.pagination.value}")
```

#### `close()`

Close connections and cleanup.

```python
client.close()
```

## Examples

See the `examples/` directory for complete working examples:

- `list_objects.py` - Discover available objects
- `query_data.py` - Query and display data

## Troubleshooting

### Authentication Errors

**Error:** `AuthenticationError: Invalid credentials`

**Solution:**
- Check your API key is correct
- Verify `.env` file exists and has `{{ driver_name.upper() }}_API_KEY`
- Ensure API key has necessary permissions

### Connection Errors

**Error:** `ConnectionError: Cannot connect to {{ api_name }}`

**Solution:**
- Check `{{ driver_name.upper() }}_API_URL` is correct
- Verify API is reachable (not down for maintenance)
- Check your network/firewall settings

### Rate Limit Errors

**Error:** `RateLimitError: API rate limit exceeded`

**Solution:**
- Wait for the time specified in `retry_after`
- Reduce query frequency
- Increase `max_retries` parameter
- Add delays between requests

### Query Syntax Errors

{% if query_language %}
**Error:** `QuerySyntaxError: Invalid {{ query_language }} syntax`

**Solution:**
- Check query syntax matches {{ query_language }} specification
- Verify field names exist using `get_fields()`
- Verify object names exist using `list_objects()`
{% else %}
Check API documentation for valid endpoints and parameters.
{% endif %}

## Development

### Running Tests

```bash
pytest tests/
```

### Type Checking

```bash
mypy {{ driver_name }}/
```

## License

MIT

## Contributing

Contributions welcome! Please:
1. Follow Driver Design v2.0 spec
2. Add tests for new features
3. Update documentation
4. Run type checker and formatter

## Support

- üìö [Driver Design v2.0](../docs/driver_design_v2.md)
- üêõ [Report Issues](https://github.com/your-org/{{ driver_name }}/issues)
{% if "posthog" in api_name.lower() %}
- üìñ [PostHog API Docs](https://posthog.com/docs/api)
{% elif "stripe" in api_name.lower() %}
- üìñ [Stripe API Docs](https://stripe.com/docs/api)
{% else %}
- üìñ [{{ api_name }} API Docs]({{ base_url }})
{% endif %}

---

**ü§ñ Generated by Driver Creator Agent**
Following [Driver Design v2.0](../docs/driver_design_v2.md) specification
