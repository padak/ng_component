"""
{% if example_type == "list_objects" %}
Example: List all available {{ api_name }} objects

This example demonstrates discovery using list_objects().
{% elif example_type == "query_data" %}
Example: Query data from {{ api_name }}

This example demonstrates querying data with discovery-first approach.
{% endif %}

ðŸ¤– AUTO-GENERATED by Driver Creator Agent
"""

from {{ driver_name }} import {{ driver_class }}
{% if example_type == "query_data" %}import json{% endif %}


def main():
    # Initialize client from environment variables
    client = {{ driver_class }}.from_env()

    try:
        {% if example_type == "list_objects" %}
        # Discover available objects
        print("Discovering {{ api_name }} objects...")
        objects = client.list_objects()

        print(f"\\nFound {len(objects)} objects:")
        for i, obj in enumerate(objects, 1):
            print(f"  {i}. {obj}")

        # Show capabilities
        print("\\n" + "="*60)
        capabilities = client.get_capabilities()
        print("Driver Capabilities:")
        print(f"  Read operations: {capabilities.read}")
        print(f"  Write operations: {capabilities.write}")
        {% if query_language %}print(f"  Query language: {capabilities.query_language}"){% endif %}
        print(f"  Pagination: {capabilities.pagination.value}")

        {% elif example_type == "query_data" %}
        # Step 1: Discover schema (discovery-first approach)
        print("Discovering {{ api_name }} schema...")
        objects = client.list_objects()
        print(f"Available objects: {', '.join(objects)}")

        # Select first object for demo
        if not objects:
            print("No objects available!")
            return

        object_name = objects[0]
        print(f"\\nQuerying object: {object_name}")

        # Get field schema
        fields = client.get_fields(object_name)
        available_fields = list(fields.keys())
        print(f"Available fields: {', '.join(available_fields[:5])}...")

        # Step 2: Build query dynamically from discovered schema
        {% if query_language %}
        # Select first 5 fields for demo
        selected_fields = available_fields[:5]
        query = f"SELECT {', '.join(selected_fields)} FROM {object_name} LIMIT 10"

        print(f"\\nExecuting query: {query}")
        results = client.read(query, limit=10)
        {% else %}
        # REST API - use read() method
        print(f"\\nReading data (limit=10)...")
        results = client.read(limit=10)
        {% endif %}

        # Step 3: Display results
        print(f"\\nFound {len(results)} records:")
        if results:
            # Show first record as sample
            print("\\nSample record:")
            print(json.dumps(results[0], indent=2))

            # Show summary
            print(f"\\nTotal records: {len(results)}")
        else:
            print("No records found.")

        {% endif %}

    finally:
        # Always close the client
        client.close()
        print("\\nDone!")


if __name__ == "__main__":
    main()
